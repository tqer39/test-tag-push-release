---
  name: Manual tag push

  on:
    workflow_dispatch:
      inputs:
        version:
          description: Release version (e.g., 2.71.0) ※vを付けないでください
          required: true

  concurrency:
    group: ${{ github.workflow }}-${{ github.ref }}
    cancel-in-progress: true

  jobs:
    release-stg:
      runs-on: ubuntu-latest
      timeout-minutes: 5
      steps:
        - name: Checkout
          uses: actions/checkout@v3

        - name: Validate version
          run: |
            VERSION="${{ github.event.inputs.version }}"
            if [[ ! $VERSION =~ ^[0-9]+\.[0-9]+\.[0-9]+$ ]]; then
              echo "Invalid version format. Please follow semantic versioning (e.g., 2.71.0)"
              exit 1
            fi

        - name: Create tag
          run: |
            GIT_TAG="release-v${{ github.event.inputs.version }}"
            BRANCH_NAME=$("git branch --show-current | sed 's|/|-|g')
            git tag $GIT_TAG "origin/${BRANCH_NAME}"
            git push origin $GIT_TAG -f
